{"ast":null,"code":"import { CarWriter } from '@ipld/car';\nexport class TreewalkCarJoiner {\n  constructor(cars) {\n    this._cars = Array.from(cars);\n    if (!this._cars.length) throw new Error('missing CARs');\n  }\n\n  async *car() {\n    const reader = this._cars[0];\n    const roots = await reader.getRoots();\n    const {\n      writer,\n      out\n    } = CarWriter.create(roots);\n\n    const writeCar = async () => {\n      const written = new Set();\n\n      const writeBlocks = async reader => {\n        for await (const b of reader.blocks()) {\n          if (written.has(b.cid.toString())) continue;\n          await writer.put(b);\n          written.add(b.cid.toString());\n        }\n      };\n\n      try {\n        await writeBlocks(reader);\n\n        for (const reader of this._cars.slice(1)) {\n          await writeBlocks(reader);\n        }\n      } catch (err) {\n        console.error(err);\n      } finally {\n        await writer.close();\n      }\n    };\n\n    writeCar();\n    yield* out;\n  }\n\n}","map":{"version":3,"sources":["/Users/g2musicgroup/Developer/NFT-starter/filecoin_nft_starter-main/node_modules/carbites/esm/lib/treewalk/joiner.js"],"names":["CarWriter","TreewalkCarJoiner","constructor","cars","_cars","Array","from","length","Error","car","reader","roots","getRoots","writer","out","create","writeCar","written","Set","writeBlocks","b","blocks","has","cid","toString","put","add","slice","err","console","error","close"],"mappings":"AAAA,SAASA,SAAT,QAA0B,WAA1B;AACA,OAAO,MAAMC,iBAAN,CAAwB;AAC7BC,EAAAA,WAAW,CAACC,IAAD,EAAO;AAChB,SAAKC,KAAL,GAAaC,KAAK,CAACC,IAAN,CAAWH,IAAX,CAAb;AACA,QAAI,CAAC,KAAKC,KAAL,CAAWG,MAAhB,EACE,MAAM,IAAIC,KAAJ,CAAU,cAAV,CAAN;AACH;;AACS,SAAHC,GAAG,GAAG;AACX,UAAMC,MAAM,GAAG,KAAKN,KAAL,CAAW,CAAX,CAAf;AACA,UAAMO,KAAK,GAAG,MAAMD,MAAM,CAACE,QAAP,EAApB;AACA,UAAM;AAACC,MAAAA,MAAD;AAASC,MAAAA;AAAT,QAAgBd,SAAS,CAACe,MAAV,CAAiBJ,KAAjB,CAAtB;;AACA,UAAMK,QAAQ,GAAG,YAAY;AAC3B,YAAMC,OAAO,GAAG,IAAIC,GAAJ,EAAhB;;AACA,YAAMC,WAAW,GAAG,MAAMT,MAAN,IAAgB;AAClC,mBAAW,MAAMU,CAAjB,IAAsBV,MAAM,CAACW,MAAP,EAAtB,EAAuC;AACrC,cAAIJ,OAAO,CAACK,GAAR,CAAYF,CAAC,CAACG,GAAF,CAAMC,QAAN,EAAZ,CAAJ,EACE;AACF,gBAAMX,MAAM,CAACY,GAAP,CAAWL,CAAX,CAAN;AACAH,UAAAA,OAAO,CAACS,GAAR,CAAYN,CAAC,CAACG,GAAF,CAAMC,QAAN,EAAZ;AACD;AACF,OAPD;;AAQA,UAAI;AACF,cAAML,WAAW,CAACT,MAAD,CAAjB;;AACA,aAAK,MAAMA,MAAX,IAAqB,KAAKN,KAAL,CAAWuB,KAAX,CAAiB,CAAjB,CAArB,EAA0C;AACxC,gBAAMR,WAAW,CAACT,MAAD,CAAjB;AACD;AACF,OALD,CAKE,OAAOkB,GAAP,EAAY;AACZC,QAAAA,OAAO,CAACC,KAAR,CAAcF,GAAd;AACD,OAPD,SAOU;AACR,cAAMf,MAAM,CAACkB,KAAP,EAAN;AACD;AACF,KApBD;;AAqBAf,IAAAA,QAAQ;AACR,WAAOF,GAAP;AACD;;AAjC4B","sourcesContent":["import { CarWriter } from '@ipld/car';\nexport class TreewalkCarJoiner {\n  constructor(cars) {\n    this._cars = Array.from(cars);\n    if (!this._cars.length)\n      throw new Error('missing CARs');\n  }\n  async *car() {\n    const reader = this._cars[0];\n    const roots = await reader.getRoots();\n    const {writer, out} = CarWriter.create(roots);\n    const writeCar = async () => {\n      const written = new Set();\n      const writeBlocks = async reader => {\n        for await (const b of reader.blocks()) {\n          if (written.has(b.cid.toString()))\n            continue;\n          await writer.put(b);\n          written.add(b.cid.toString());\n        }\n      };\n      try {\n        await writeBlocks(reader);\n        for (const reader of this._cars.slice(1)) {\n          await writeBlocks(reader);\n        }\n      } catch (err) {\n        console.error(err);\n      } finally {\n        await writer.close();\n      }\n    };\n    writeCar();\n    yield* out;\n  }\n}"]},"metadata":{},"sourceType":"module"}